<nav class="navbar navbar-desktop">
  <div class="navbar-left">
    <a href="/" class="navbar-logo" aria-label="Home">
      <img src="https://res.cloudinary.com/dcfmvazgl/image/upload/v1736335480/Wash%20portfolio/logo_fxcjk2.png" alt="Logo" />
    </a>

    <div class="navbar-links">
      <a class="nav-btn" href="#projects">Projects</a>
      <a class="nav-btn" href="#contact">Contact</a>
    </div>
  </div>

  <div class="navbar-right">
    <div class="dropdown">
      <button class="nav-btn dropdown-toggle" type="button" aria-haspopup="true" aria-expanded="false">
        Language<span class="chevron" aria-hidden="true"></span>
      </button>

      <div class="dropdown-menu" role="menu" aria-label="Language">
        <a class="dropdown-item" href="?lang=en" role="menuitem">English</a>
        <a class="dropdown-item" href="?lang=es" role="menuitem">Spanish</a>
        <a class="dropdown-item" href="?lang=pt" role="menuitem">Portuguese</a>
        <a class="dropdown-item" href="?lang=fr" role="menuitem">French</a>
      </div>
    </div>
  </div>
</nav>

<script>
  (() => {
    let initialized = false;

    const findScrollContainer = () => {
      // Preferimos el elemento nativo si existe y se mueve
      const se = document.scrollingElement;
      if (se && se.scrollHeight > se.clientHeight) return se;

      // Si no, buscamos un contenedor con overflow auto/scroll y overflow real
      const all = Array.from(document.querySelectorAll("*"));
      for (const el of all) {
        const s = getComputedStyle(el);
        const oy = s.overflowY;
        if ((oy === "auto" || oy === "scroll") && el.scrollHeight > el.clientHeight) {
          return el;
        }
      }
      return null;
    };

    const initNavbarScroll = () => {
      if (initialized) return;
      initialized = true;

      const navbar = document.querySelector(".navbar");
      if (!navbar) return;

      const threshold = 24;
      const scroller = findScrollContainer();

      // Si no hay scroller real, no hacemos nada (tu pÃ¡gina es corta)
      if (!scroller) return;

      const getY = () => (scroller === document.scrollingElement ? window.scrollY : scroller.scrollTop);

      const onScroll = () => {
        const y = getY();
        navbar.classList.toggle("is-scrolled", y > threshold);
      };

      onScroll();
      scroller.addEventListener("scroll", onScroll, { passive: true });
      // Por si el scroller nativo es document:
      window.addEventListener("scroll", onScroll, { passive: true });
    };

    document.addEventListener("turbo:load", initNavbarScroll);
  })();
</script>
